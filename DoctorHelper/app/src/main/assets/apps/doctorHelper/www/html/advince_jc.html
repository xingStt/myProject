<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>检查医嘱</title>
    <link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.poppicker.css"/>
    <link rel="stylesheet" type="text/css" href="../css/advince.css"/>
    <style type="text/css">
    	body{
    		background: #F6F6F6;
    		padding: 1rem;
    	}
    </style>
</head>
<body id="body">
	<div class="conditon">
		<div>加急</div>
		<div class="mui-switch">
			<div class="mui-switch-handle"></div>
		</div>
		<div>预约</div>
		<div>
			<button id='btnyy' class="my-picker">点击选择时间</button>
		</div>
		<div id="dateClear">
			<span class="mui-icon mui-icon-closeempty"></span>
		</div>
	</div>
	<div class="mui-input-row mui-search">
		<input id="search" type="search" onkeyup="fnSearch()" class="mui-input-clear" placeholder="拼音">
	</div>
	<div class="itemContent">
		<div class="table-div">
			<div class="first header">
				检查项目
			</div>
			<div class="second header">
				执行科室
			</div>
			<div class="three header">
				价格
			</div>
			<div class="four header">
				&nbsp;
			</div>
		</div>
	</div>
	<div class="save-div">
		<button>保&nbsp;&nbsp;&nbsp;&nbsp;存</button>
	</div>
	<div id="searchBox" class="searchBox">
	</div>
</body>
</html>
<script src="../script/zepto.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/mui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/mui.poppicker.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/react.production.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/react-dom.production.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/babel.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../script/common.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
   $('#dateClear').on('tap',function(){
   		$('#btnyy').html('点击选择时间');
   		$('#btnyy').css('color','#999');
   		$(this).hide();
   });
   	
   $('#btnyy').on('tap',function(){
   		var picker = new mui.DtPicker({type:'datetime'});
		picker.show(function(rs) {
			$('#btnyy').html(rs.text);
			$('#btnyy').css('color','#333');
			$('#dateClear').show();
			picker.dispose();
		});
   });
   
    function showDept(target){
		//普通示例
		var userPicker = new mui.PopPicker();
		userPicker.setData([{
			value: 'ywj',
			text: '董事长 叶文洁'
		}, {
			value: 'aaa',
			text: '总经理 艾AA'
		}, {
			value: 'lj',
			text: '罗辑'
		}, {
			value: 'ymt',
			text: '云天明'
		}, {
			value: 'shq',
			text: '史强'
		}, {
			value: 'zhbh',
			text: '章北海'
		}, {
			value: 'zhy',
			text: '庄颜'
		}, {
			value: 'gyf',
			text: '关一帆'
		}, {
			value: 'zhz',
			text: '智子'
		}, {
			value: 'gezh', 
			text: '歌者'
		}]);
		
		userPicker.show(function(items) {
			$(target).parent().html(items[0].text);
		});
	}
</script>

<script type="text/babel">
	function fnSearch(){
		let piniyin = $('#search').val();
		if(piniyin.length<2){
			return;
		}
		$.ajax({
	        type: 'POST',
	        url: 'http://localhost:8080/deskNurse/doctor/getPacsItem.do',
	        data:{pinyin:piniyin},
	        dataType: "json",
	        success: function(data){
	        	$('#searchBox').show();
	        	if(data.length>0){
	        		ReactDOM.render(
				  	  <Table data = {data}/>,
					  document.getElementById('searchBox')
					);
	        	}else{
	        		ReactDOM.render(
				  	  '',
					  document.getElementById('searchBox')
					);
	        	}
	        }
	 	});
	}
	
	function Table(props){
		let data = props.data;
		let items = [];
		for(let i=0;i<data.length;i++){
			let dept = data[i].exec_dept;
			
			let price = data[i].price;
			
			items.push(<PacsItem itemid={data[i].itemid} name={data[i].name}
				dept={dept} price={price}/>);
		}
		return (<div>
				  <table class="table" cellspacing="0" cellpadding="0">
					<thead>
					  <tr>
					  	<th>项目</th>
					  	<th>执行科室</th>
					  	<th>价格</th>
					  </tr>
					</thead>
					<tbody>
						{items}
					</tbody>
			      </table>
			      <CloseBtn />
			    </div>
	    );
	}
	
	class CloseBtn extends React.Component{
	  constructor(props) {
	    super(props);
	    this.handleClick = this.handleClick.bind(this);
	  }
	
	  handleClick() {
	  	$('#searchBox').hide();
	  }
	
	  render() {
	    return (
	        <div class="btn-close">
			  <div onClick={this.handleClick}></div>
		    </div>
	    );
	  }
	}
	
	let itemids = [];
	
	class PacsItem extends React.Component{
	  constructor(props) {
	    super(props);
		this.itemid = props.itemid;
		this.name = props.name;
		this.dept = props.dept;
		this.price = props.price;
	    this.handleClick = this.handleClick.bind(this);
	  }
		
	  handleClick() {
	  	itemids.push(this.itemid);
	  	let depttmp = this.dept;
	  	if(!depttmp){
	  		depttmp = '<a onclick="showDept(this)">选择科室<a/>'
	  	}
	  	
	  	let pricetmp = this.price;
	  	if(!pricetmp){
	  		pricetmp = '无默认';
	  	}
	  	
	  	let item = `<div class="first body">
						${this.name}
					</div>
					<div class="second body">
						${depttmp}
					</div>
					<div class="three body">
						${pricetmp}
					</div>
					<div class="four body" onclick="fnClear(this,${this.itemid})">
						<span class="mui-icon mui-icon-closeempty"></span>
					</div>`;
	  	$('.table-div').append(item)
	  	$('#searchBox').hide();
	  	$('#search').val('');
	  }
	
	  render() {
	    return (
	        <tr onClick={this.handleClick}>
	        	<td>{this.name}</td>
	        	<td>{this.dept}</td>
	        	<td>{this.price}</td>
	        </tr>
	    );
	  }
	}
	
	function fnClear(target,itemid){
		itemids.remove(itemid);
		$(target).prev().prev().prev().remove();
		$(target).prev().prev().remove();
		$(target).prev().remove();
		$(target).remove();
	}
</script>
